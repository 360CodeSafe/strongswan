sudo: false

language: c

compiler:
  - gcc
  - clang

script:
  - ./autogen.sh
  - ./scripts/test.sh

env:
  global:
    - TESTS_REDUCED_KEYLENGTHS=yes
    - LEAK_DETECTIVE=no
    - MONOLITHIC=no
  matrix:
    - TEST=default
    - TEST=default MONOLITHIC=yes
    - TEST=default LEAK_DETECTIVE=yes
    - TEST=openssl
    - TEST=openssl LEAK_DETECTIVE=yes
    - TEST=gcrypt
    - TEST=gcrypt LEAK_DETECTIVE=yes
    # we can't test Vstr as negative int args are not properly passed to CBs
    - TEST=printf-builtin
    - TEST=printf-builtin LEAK_DETECTIVE=yes
    - TEST=all
    - TEST=all MONOLITHIC=yes
    - TEST=all LEAK_DETECTIVE=yes

matrix:
  include:
    - compiler: gcc
      env: TEST=dist
    - compiler: gcc
      env: TEST=win64 MONOLITHIC=yes
    - compiler: gcc
      env: TEST=win32 MONOLITHIC=yes

addons:
  apt:
    packages:
      - bison
      - flex
      - gperf
      - gettext
      - libgmp-dev
      - libssl-dev
      - libgcrypt11-dev
      - libcurl4-gnutls-dev
      - libsoup2.4-dev
      - libunbound-dev
      - libldns-dev
      - libmysqlclient-dev
      - libsqlite3-dev
      - clearsilver-dev
      - libfcgi-dev
      - libnm-glib-dev
      - libnm-glib-vpn-dev
      - libpcsclite-dev
      - libpam0g-dev
      - binutils-dev
      - libunwind7-dev
      - libjson0-dev
      - iptables-dev
      - python-pip
      - gcc-mingw-w64-base
      - mingw-w64-dev
      - gcc-mingw-w64-x86-64
      - binutils-mingw-w64-x86-64
      - gcc-mingw-w64-i686
      - binutils-mingw-w64-i686